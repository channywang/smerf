<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: SmerfFile</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">SmerfFile</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/smerf_file_rb.html">
                app/models/smerf_file.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="SmerfItem.html">
                SmerfItem
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This class contains functions to work with the smerf form definition file.
It will read the file validating the format of the file, if any errors are
found a <em>RuntimeError</em> exception will be raised.
</p>
<p>
Once the file has been validated all objects created during the process
will be serialized to the smerf_forms DB table. Subsequent calls to the
form will simplay unserialize the objects from the DB rather then
reporcessing the definition file.
</p>
<p>
If changes are made to the definition file the system will again call
functions within this class to rebuild the form objects. Refer to the
rebuild_cache method within the smerfform.rb file to see how this all
works.
</p>
<p>
When setting up a <a href="SmerfFile.html#M000029">new</a> form the first
thing we do is define some settings for the form as a whole. Currently the
following items can be defined for the form:
</p>
<table>
<tr><td valign="top">name:</td><td>Name of the form (mandatory)

</td></tr>
<tr><td valign="top">welcome:</td><td>Message displayed at the start of the form (optional)

</td></tr>
<tr><td valign="top">thank_you:</td><td>Message displayed at the end of the form (optional)

</td></tr>
<tr><td valign="top">group_sort_order_field:</td><td>Nominates which group field to use when sorting groups for display
(mandatory)

</td></tr>
<tr><td valign="top">groups:</td><td>Defines the question groups within the form (mandatory)

</td></tr>
</table>
<p>
Here is the definition for the test form included with the plugin:
</p>
<pre>
   ---
   smerfform:
     name: Test SMERF Form
     welcome: |
       &lt;b&gt;Welcome:&lt;/b&gt;&lt;br&gt;
       Thank you for taking part in our Test survey we appreciate your
       input.&lt;br&gt;&lt;br&gt;

       &lt;b&gt;PRIVACY STATEMENT&lt;/b&gt;&lt;br&gt;
       We will keep all the information you provide private and not share
       it with anyone else....&lt;br&gt;

     thank_you: |
       &lt;b&gt;Thank you for your input.&lt;/b&gt;&lt;br&gt;&lt;br&gt;

       Should you wish to discuss this survey please contact&lt;br&gt;
       Joe Bloggs&lt;br&gt;
       Tel. 12 345 678&lt;br&gt;
       e-mail &lt;A HREF=\&quot;mailto:jbloggs@xyz.com.au\&quot;&gt;Joe's email&lt;/A&gt;&lt;br&gt;&lt;br&gt;

       February 2007
     group_sort_order_field: code

     groups:
     ...
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000027">clear</a>&nbsp;&nbsp;
      <a href="#M000028">modified?</a>&nbsp;&nbsp;
      <a href="#M000029">new</a>&nbsp;&nbsp;
      <a href="#M000030">validate</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">code</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">group_objects</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">group_sort_order_field</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">smerf_file_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">smerf_record</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">thank_you</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">welcome</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000028" class="method-detail">
        <a name="M000028"></a>

        <div class="method-heading">
          <a href="SmerfFile.src/M000028.html" target="Code" class="method-signature"
            onclick="popupCode('SmerfFile.src/M000028.html');return false;">
          <span class="method-name">modified?</span><span class="method-args">(code, db_timestamp)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method checks if the form definition file has been modified by
comparing the timestamp of the form definition file against the timestamp
stored in the smerf_forms DB table, if they are not the same the form is
rebuilt.
</p>
        </div>
      </div>

      <div id="method-M000029" class="method-detail">
        <a name="M000029"></a>

        <div class="method-heading">
          <a href="SmerfFile.src/M000029.html" target="Code" class="method-signature"
            onclick="popupCode('SmerfFile.src/M000029.html');return false;">
          <span class="method-name">new</span><span class="method-args">(code)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
When a <a href="SmerfFile.html#M000029">new</a> <a
href="SmerfFile.html">SmerfFile</a> object is created this method gets
executed. It performs a number of function including:
</p>
<ul>
<li>make sure the form definition file actually exists

</li>
<li>opens and reads all the data from the file

</li>
<li>makes sure the file contains a form definition

</li>
<li>initialises variables

</li>
</ul>
<p>
Refer to the rebuild_cache method within the smerfform.rb file.
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000027" class="method-detail">
        <a name="M000027"></a>

        <div class="method-heading">
          <a href="SmerfFile.src/M000027.html" target="Code" class="method-signature"
            onclick="popupCode('SmerfFile.src/M000027.html');return false;">
          <span class="method-name">clear</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method clears all class variables, as these are class vars they are
created at startup and then exists for the duration of the app. We want to
<a href="SmerfFile.html#M000027">clear</a> all values in these vars when we
process a <a href="SmerfFile.html#M000029">new</a> form definition file.
</p>
        </div>
      </div>

      <div id="method-M000030" class="method-detail">
        <a name="M000030"></a>

        <div class="method-heading">
          <a href="SmerfFile.src/M000030.html" target="Code" class="method-signature"
            onclick="popupCode('SmerfFile.src/M000030.html');return false;">
          <span class="method-name">validate</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method performs the bulk of the processing. Once the file is opened
and the data has been read into memory this method processes the data. It
processes all the groups, questions, answers and subquestions of the form
creating the appropriate objects as required.
</p>
<p>
As it processes the data it also performs validation on the data to make
sure all required fields have been specified in the definition file. If any
errors are found a <em>RuntimeError</em> exception will be raised.
</p>
<p>
Refer to the rebuild_cache method within the smerfform.rb file.
</p>
<p>
The following object will be created during this process:
</p>
<ul>
<li><a href="SmerfGroup.html">SmerfGroup</a>

</li>
<li><a href="SmerfQuestion.html">SmerfQuestion</a>

</li>
<li><a href="SmerfAnswer.html">SmerfAnswer</a>

</li>
</ul>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>